<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Movies by Genre</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link href="WebPage_2.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="templatemo_container">
    <div id="templatemo_menu">
        <ul></ul>
    </div> <!-- end of menu -->

    <div id="templatemo_header"></div> <!-- end of header -->

    <div id="templatemo_content">
        <div class="templatemo_content_left_section"></div>

        <div id="templatemo_content_right">
            <h1 id="title">Loading...</h1>

            <div id="movieContainer"></div> <!-- จะเอาหนังมาแสดงตรงนี้ -->

            <div class="cleaner_with_height">&nbsp;</div>
        </div>

        <div class="cleaner_with_height">&nbsp;</div>
    </div> <!-- end of content -->
</div> <!-- end of container -->

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const genre = urlParams.get('genre');

    document.getElementById('title').innerText = `${genre} Movies`;

    fetch(`http://localhost:8080/WebTest1/api/movies?genre=${encodeURIComponent(genre)}`)
        .then(response => {
            if (!response.ok) throw new Error("Network response was not ok");
            return response.json();
        })
        .then(data => {
            const container = document.getElementById('movieContainer');
            container.innerHTML = '';

            data.forEach(movie => {
                const movieBox = document.createElement('div');
                movieBox.className = 'templatemo_product_box';

                movieBox.innerHTML = `
                    <h1 style="color: ${movie.hexCode};">${movie.title} <span>(${genre})</span></h1>
                    <img src="images/templatemo_image_01.jpg" alt="image" />
                    <div class="product_info">
                        <p>${movie.description || 'No description available.'}</p>
                        <a href="movie.html?title=${encodeURIComponent(movie.title)}&genre=${encodeURIComponent(genre)}"
                           style="color: ${movie.hexCode}; text-decoration: none;">View Details</a>
                    </div>
                    <div class="cleaner">&nbsp;</div>
                `;

                container.appendChild(movieBox);
            });
        })
        .catch(error => {
            console.error("Fetch error:", error);
            document.getElementById('title').innerText = "Failed to load movies";
        });
</script>
</body>
</html>
